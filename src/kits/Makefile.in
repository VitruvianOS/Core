prefix=@prefix@
libdir=${prefix}/lib

CFLAGS = -include build/BeOSBuildCompatibility.h \
-Wall -Wpointer-arith -Wcast-align -Wsign-compare -Wno-multichar \
-c -g -O2 -pipe `cat @top_srcdir@/cosmoe.specs` -fPIC

#TODO remove -fpermissive
CPPFLAGS = $(CFLAGS) -Woverloaded-virtual -Wno-ctor-dtor-privacy -Wnon-virtual-dtor -fexceptions -fpermissive

LIBNAME = libcosmoe.@LIBEXT@

VPATH += ./ support kernel storage storage/mime storage/sniffer app interface interface/BTextView shared

KERNEL_KIT_OBJS = area.o direntfd.o misc.o	real_time_clock.o \
atomic.o fs.o parsedate.o sem.o dirent.o image.o \
port.o thread.o

SUPPORT_KIT_OBJS = Archivable.o BufferedDataIO.o  Flattenable.o  Referenceable.o \
ArchivingManagers.o BufferIO.o	StopWatch.o ByteOrder.o List.o String.o \
Beep.o DataIO.o Locker.o StringList.o BlockCache.o DateTime.o PointerList.o Url.o

STORAGE_KIT_OBJS = AppFileInfo.o MimeType.o	ResourcesContainer.o \
Directory.o Node.o Resources.o Entry.o NodeInfo.o	ResourceStrings.o \
EntryList.o NodeMonitor.o File.o OffsetFile.o Statable.o \
FilePanel.o Path.o storage_support.o FindDirectory.o Query.o \
SymLink.o kernel_interface.POSIX.o  QueryPredicate.o	Volume.o \
ResourceFile.o VolumeRoster.o Mime.o ResourceItem.o \
AssociatedTypes.o	     database_support.o  Supertype.o \
CreateAppMetaMimeThread.o  InstalledTypes.o    SupportingApps.o \
database_access.o	     MimeUpdateThread.o  UpdateMimeInfoThread.o \
Database.o		     SnifferRules.o CharStream.o	Err.o \
Pattern.o      Range.o	   RPatternList.o \
DisjList.o	Parser.o  PatternList.o  RPattern.o  Rule.o

APP_KIT_OBJS = AppDefs.o Looper.o PortQueue.o \
Application.o LooperList.o PropertyInfo.o \
AppMisc.o	MessageBody.o RegistrarDefs.o \
AppServerLink.o Message.o RegistrarThread.o \
AreaLink.o MessageField.o RegistrarThreadManager.o \
Clipboard.o MessageFilter.o Roster.o \
Cursor.o MessageQueue.o	RosterPrivate.o \
Handler.o MessageRunner.o \
InitTerminateLibBe.o MessageUtils.o Session.o \
Invoker.o Messenger.o TokenSpace.o \
LinkMsgReader.o PortLink.o \
LinkMsgSender.o PortMessage.o

INTERFACE_KIT_OBJS = Alert.o ColorUtils.o ListView.o Point.o ScrollBar.o TextControl.o \
Bitmap.o Control.o MenuBar.o Polygon.o ScrollView.o TextInput.o \
BMCPrivate.o Deskbar.o Menu.o PopUpMenu.o Shape.o TPicture.o \
Box.o Dragger.o MenuField.o PrivateScreen.o Shelf.o View.o \
Font.o MenuItem.o RadioButton.o Slider.o Window.o \
Button.o GraphicsDefs.o OptionControl.o Rect.o StatusBar.o ZombieReplicantView.o \
CheckBox.o Input.o OutlineListView.o Region.o \
ClientFontList.o InterfaceDefs.o PictureButton.o StringView.o \
ColorControl.o ListItem.o Picture.o Screen.o TabView.o \
InlineInput.o TextView.o WidthBuffer.o \
LineBuffer.o TextGapBuffer.o UndoBuffer.o StyleBuffer.o RegionSupport.o

SHARED_KIT_OBJS = DataBuffer.o


CC = @CC@

OBJS += $(KERNEL_KIT_OBJS)
OBJS += $(SUPPORT_KIT_OBJS)
OBJS += $(STORAGE_KIT_OBJS)
OBJS += $(APP_KIT_OBJS)
OBJS += $(INTERFACE_KIT_OBJS)
OBJS += $(SHARED_KIT_OBJS)

OBJDIR	:= objs

include @top_srcdir@/makefile.rules

all :	$(OBJDIR) $(OBJDIR)/$(LIBNAME)

$(OBJDIR):
	mkdir $(OBJDIR)

$(OBJDIR)/$(LIBNAME): $(OBJS)
	$(CC) @SHAREDLINK@ $(OBJS) -lstdc++ -lm -lpthread -ldl -o $(OBJDIR)/$(LIBNAME)

install: $(OBJDIR)/$(LIBNAME) $(libdir)
	cp -f $< $(libdir)/$(LIBNAME)

uninstall:
	rm -f $(libdir)/$(LIBNAME)

$(libdir):
	mkdir -p $(libdir)

doc:
	-rm -R docs/*
	doxygen libcosmoe.dox

deps: $(OBJDIR) $(DEPS)

clean:
	rm -f $(OBJS) $(OBJDIR)/$(LIBNAME) $(OBJDIR)/*.d *~ */*~ core*
	rm -rf docs/*

distclean: clean
	rm -f Makefile
	rm -rf autom4te.cache

-include $(OBJDIR)/*.d

.PHONY: clean distclean deps doc install uninstall all
